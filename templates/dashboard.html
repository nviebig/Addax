<!DOCTYPE html>
<html>
<head>
  <title>Sahel Overview</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css">
  <style>
    /* Ensure the entire page is used */
    body, html {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      font-family: 'Segoe UI', sans-serif;
    }
    /* Map container fills the whole screen */
    #map {
      width: 100%;
      height: 100%;
    }
    /* Overlay box positioned in the top-right corner */
    .overlay {
      position: absolute;
      top: 0;
      right: 0;
      width: 350px;  /* a bit wider */
      height: 100%;  /* go all the way down */
      background-color: rgba(128, 128, 128, 0.4); /* translucent grey */
      padding: 20px;
      box-sizing: border-box;
      text-align: center;
      z-index: 1000;
    }
    .overlay h1 {
      color: #fff;
      margin-bottom: 20px;
    }
    #analysisButton {
      padding: 10px 20px;
      font-size: 1em;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <!-- Overlay with title and button in the top-right corner -->
  <div class="overlay">
    <h1>Overview Dashboard</h1>
    <button id="analysisButton" onclick="window.location.href='/sahel_comparison'">Sahel Wide Analysis</button>
  </div>
  
  <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
  <script>
    // Create the map centered on the Sahel region.
    var map = L.map('map').setView([15, 10], 6);
    
    // Add the base tile layer.
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Â© OpenStreetMap contributors'
    }).addTo(map);
    
    // Array of countries with their respective GeoJSON file names.
    var countries = [
      { name: "Burkina Faso", file: "burkinafaso.json" },
      { name: "Chad", file: "chad.json" },
      { name: "Mauritania", file: "mauritania.json" },
      { name: "Niger", file: "niger.json" },
      { name: "Senegal", file: "senegal.json" },
      { name: "Sudan", file: "sudan.json" },
      { name: "Mali", file: "mali.json" }
    ];
    
    // For each country, load the GeoJSON, add tooltips and interactivity.
    countries.forEach(function(country) {
      fetch("/static/geojson/" + country.file)
        .then(function(response) { return response.json(); })
        .then(function(geojsonData) {
          // Create a GeoJSON layer and bind a tooltip for each feature.
          var geojsonLayer = L.geoJSON(geojsonData, {
            style: function(feature) {
              return {
                fillColor: "transparent",
                fillOpacity: 0,
                color: "black",
                weight: 2
              };
            },
            onEachFeature: function(feature, layer) {
              // Bind tooltip with the country name.
              layer.bindTooltip("<div style='text-align:center;'><strong style='font-size:1.2em;'>" + country.name + "</strong></div>", {sticky: true});
            }
          });
          
          // Group all features of a country so they behave as one.
          var group = L.featureGroup(geojsonLayer.getLayers());
          
          // Attach event handlers to all layers in the group.
          group.eachLayer(function(layer) {
            layer.on('mouseover', function(e) {
              // When hovering over any feature, highlight the entire group.
              group.eachLayer(function(l) {
                l.setStyle({
                  fillColor: "grey",
                  fillOpacity: 0.5
                });
              });
              // Open the tooltip on the feature that triggered the event.
              e.target.openTooltip();
            });
            layer.on('mouseout', function(e) {
              // On mouse out, revert style for all features in the group.
              group.eachLayer(function(l) {
                l.setStyle({
                  fillColor: "transparent",
                  fillOpacity: 0
                });
              });
              e.target.closeTooltip();
            });
          });
          
          // Attach a click event for redirection.
          group.on('click', function(e) {
            var targetUrl = '/dashboard/' + country.name.toLowerCase().replace(/\s+/g, '');
            console.log("Redirecting to:", targetUrl);
            window.location.href = targetUrl;
          });
          
          // Add the group to the map.
          group.addTo(map);
        })
        .catch(function(error) {
          console.error("Error loading geojson for " + country.name + ": " + error);
        });
    });
  </script>
</body>
</html>